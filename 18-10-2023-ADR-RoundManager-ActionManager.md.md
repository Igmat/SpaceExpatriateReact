# ADR: Ограничение доступа к RoundManager через ActionManager

## Context

В рамках нашей программы разработана архитектура, включая ActionManager.ts, RoundManager.ts и подчиненные менеджеры EAM, TAM, DAM, MAM. 
RoundManager отвечает за управление раундами, фазами и шагами. Однако в процессе разработки была допущена ошибка, когда разработчики попытались прямо переключать раунды из подчиненных файлов, обходя ActionManager. Это привело к некорректной работе программы и сложностям в отслеживании состояния раундов, а так же в управлении состояниями между раундами.

## Decision

Для обеспечения надежной и предсказуемой работы программы, принято следующее решение:

1. Для всех операций, связанных с управлением раундами, необходимо использовать только ActionManager.
В нем реализована функция "nextRound", которая отвечает за переход между раундами, передает задачи в раунд менеджер, завершает логику работы колоний и меняет статус activeAction.
2. ActionManager будет служить как посредник между RoundManager и подчиненными файлами (EAM, TAM, DAM, MAM). Это означает, что подчиненные файлы больше не будут иметь прямого доступа к RoundManager, и все операции с раундами будут выполняться через ActionManager.
В главном ActionManager собраны функции для всех общих действий с распределением по подчиненным менеджерам. Все подчиненные менеджеры имеют геттер isEnded, который завершает их логику и проверяет, может ли данная ветка быть завершена. Если по правилам после определенных действий игра должна автоматически перейти на следующий раунд, все действия описываются внутри главного менеджера: активное действие -> вызов isEnded -> переход на следующий раунд. Пример кода: 

  activateDeck = (type: CardType) => { //основная функция в ActionManager для всех подчиненных менеджеров
    if (!this.activeAction) return;
    this.managers[this.activeAction].activateDeck(type);//после этого действия игра должна переходить в новый раунд
    this.managers[this.activeAction].isEnded && this.nextRound();//isEnded завершает все необходимые действия и возвращает true, если подчиненный менеджер может перейти на следующий раунд, в таком случае срабатывает this.nextRound() в главном  ActionManager
  };


## Consequences

- Обеспечит более надежную и управляемую архитектуру программы, предотвращая некорректные переходы между раундами.
- Упростит отслеживание и обслуживание состояния раундов.

